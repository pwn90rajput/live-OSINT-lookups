<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>OSINT Monitor — Free, No Keys</title>
  <style>
    :root { --bg:#0b1020; --card:#0f1a34; --txt:#e7ecff; --muted:#a9b4d6; --accent:#7aa2ff; --good:#1bd760; --warn:#ffbd2e; --bad:#ff5c77; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--txt);font:15px/1.55 system-ui,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:1200px;margin:24px auto;padding:0 16px}
    h1{margin:0 0 6px;font-size:28px}
    h2{margin:12px 0 10px}
    h3{margin:6px 0}
    .sub{color:var(--muted)}
    .card{background:var(--card);border-radius:14px;padding:14px;margin:12px 0}
    .grid{display:grid;grid-template-columns:1fr 1fr auto auto auto;gap:10px;align-items:end}
    label{display:block;color:var(--muted);font-size:13px;margin:0 0 4px}
    input{padding:10px;border-radius:10px;border:1px solid #23325a;background:#0b1430;color:var(--txt)}
    button{padding:10px 14px;border-radius:10px;border:0;background:var(--accent);color:#001040;font-weight:600;cursor:pointer}
    button[disabled]{opacity:.6;cursor:not-allowed}
    button.ghost{background:transparent;color:var(--accent);border:1px solid var(--accent)}
    .muted{color:var(--muted)}
    .small{font-size:13px}
    .tbl{width:100%;border-collapse:collapse}
    .tbl th,.tbl td{padding:9px;border-bottom:1px solid #22325a;vertical-align:top}
    .tbl thead th{position:sticky;top:0;background:var(--card);z-index:1}
    .tbl tr:hover{background:#101f45}
    .kv td{padding:7px;border-bottom:1px solid #22325a}
    .summary{display:flex;flex-wrap:wrap;gap:10px}
    .badge{padding:4px 10px;border-radius:999px;font-weight:700;font-size:12px;display:inline-block}
    .badge.good{background:rgba(27,215,96,.15);color:var(--good);border:1px solid rgba(27,215,96,.4)}
    .badge.warn{background:rgba(255,189,46,.15);color:var(--warn);border:1px solid rgba(255,189,46,.4)}
    .badge.bad{background:rgba(255,92,119,.15);color:var(--bad);border:1px solid rgba(255,92,119,.4)}
    .row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
    .spinner{width:16px;height:16px;border:2px solid #2a3a6a;border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite;display:inline-block}
    @keyframes spin{to{transform:rotate(360deg)}}
    .pill{border:1px solid #23325a;border-radius:10px;padding:4px 8px}
    a{color:#9ec0ff}
    #logos img{max-height:64px;border-radius:10px;background:#0b1430;padding:6px}
    .toolbox{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
    .toolcard{border:1px solid #23325a;border-radius:12px;padding:10px}
    .toolcard h3{margin:0 0 8px}
    .toolcard ul{margin:0;padding-left:18px}
    .toolcard li{margin:4px 0}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>OSINT Monitor — Free, No Keys</h1>
      <p class="sub">Live client-side lookups for any <b>Domain</b> or <b>Brand</b>. Uses DNS-over-HTTPS, RDAP, CT logs, GeoIP and community subdomain data. Works on GitHub Pages.</p>
    </header>

    <section class="card">
      <form id="f" class="grid" autocomplete="off">
        <div>
          <label for="domain">Domain (FQDN)</label>
          <input id="domain" type="text" placeholder="example.com" inputmode="url" spellcheck="false" />
        </div>
        <div>
          <label for="brand">Brand (no TLD)</label>
          <input id="brand" type="text" placeholder="dell" inputmode="text" spellcheck="false" />
        </div>
        <button type="submit" id="scanBtn">Scan</button>
        <button type="button" id="demo" class="ghost" title="Run a demo scan">Demo</button>
        <div class="row">
          <button type="button" id="dljson" class="ghost" title="Download last results as JSON">Download JSON</button>
          <button type="button" id="dlcsv" class="ghost" title="Download brand sweep as CSV">Download CSV</button>
        </div>
      </form>
      <p class="muted small">Tip: <b>Brand-only</b> mode sweeps many TLDs (e.g., dell.in, dell.ru, dell.xyz) and harvests CT lookalikes. All sources are free; some rate-limits apply.</p>
    </section>

    <section class="card">
      <h2>Summary</h2>
      <div id="summary" class="summary"></div>
      <div id="progress" class="muted small" aria-live="polite"></div>
    </section>

    <section class="card">
      <h2>Brand TLD Sweep</h2>
      <table id="tld" class="tbl"><thead></thead><tbody></tbody></table>
    </section>

    <section class="card">
      <h2>WHOIS / RDAP (Domain)</h2>
      <table class="kv"><tbody id="rdap"></tbody></table>
    </section>

    <section class="card">
      <h2>DNS Records (Domain)</h2>
      <table id="dns" class="tbl"><thead></thead><tbody></tbody></table>
    </section>

    <section class="card">
      <h2>Mail Security</h2>
      <table id="mail" class="tbl"><thead></thead><tbody></tbody></table>
    </section>

    <section class="card">
      <h2>IP Geo / ASN</h2>
      <table id="geo" class="tbl"><thead></thead><tbody></tbody></table>
    </section>

    <section class="card">
      <h2>Certificate Transparency — Lookalikes</h2>
      <table id="ct" class="tbl"><thead></thead><tbody></tbody></table>
    </section>

    <section class="card">
      <h2>Subdomains</h2>
      <table id="subs" class="tbl"><thead></thead><tbody></tbody></table>
    </section>

    <!-- New: Public Emails -->
    <section class="card">
      <h2>Public Emails (discovered)</h2>
      <table id="emails" class="tbl"><thead></thead><tbody></tbody></table>
    </section>

    <!-- New: Logos & Branding -->
    <section class="card">
      <h2>Logos & Branding</h2>
      <div id="logos" class="row" style="flex-wrap:wrap;gap:12px"></div>
      <table id="branding" class="tbl"><thead></thead><tbody></tbody></table>
    </section>

    <!-- New: Social Profiles -->
    <section class="card">
      <h2>Social Profiles</h2>
      <table id="social" class="tbl"><thead></thead><tbody></tbody></table>
    </section>

    <!-- New: OSINT Toolbox (Quick Links) -->
    <section class="card">
      <h2>OSINT Toolbox (Quick Links)</h2>
      <div id="toolbox" class="toolbox"></div>
      <p class="muted small">Note: These are direct links to free/community tools. Some may require a free sign-in.</p>
    </section>

    <footer class="card">
      <div class="row">
        <span class="pill">Sources: Cloudflare & Google DoH, rdap.org, ipwho.is, crt.sh (via read-only mirror), sonar.omnisint.io</span>
        <span class="pill">No API keys • No login • Static hosting</span>
      </div>
    </footer>
  </div>

<script>
// ===== Utilities =====
const $ = (s)=>document.querySelector(s);
const esc = (s)=> (s??'').toString().replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));

// CSV/JSON downloads
let LAST = {};
function downloadJSON(obj, name='osint_results.json'){
  try{
    const blob = new Blob([JSON.stringify(obj,null,2)], {type:'application/json'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=name;
    document.body.appendChild(a); a.click(); URL.revokeObjectURL(a.href); a.remove();
  }catch(e){ alert('Could not download JSON'); }
}
function toCSV(rows, headers){
  const all=[headers,...rows];
  return all.map(r=>r.map(x=>{
    const s=(x??'').toString(); return /[",\n]/.test(s)? '"'+s.replace(/"/g,'""')+'"' : s;
  }).join(',')).join('\n');
}
function downloadCSV(rows, headers, name='tld_sweep.csv'){
  try{
    const blob = new Blob([toCSV(rows, headers)], {type:'text/csv'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=name;
    document.body.appendChild(a); a.click(); URL.revokeObjectURL(a.href); a.remove();
  }catch(e){ alert('Could not download CSV'); }
}

// Fetch JSON with best-effort CORS fallback
async function getJSON(url){
  try{
    const r = await fetch(url, {headers:{'accept':'application/json'}});
    if(r.ok){
      const ct = r.headers.get('content-type')||'';
      if(ct.includes('application/json')) return await r.json();
      const txt = await r.text(); return JSON.parse(txt);
    }
  }catch(e){}
  try{ // read-only mirror fallback
    const proxy = 'https://r.jina.ai/http://' + url.replace(/^https?:\/\//,'');
    const r2 = await fetch(proxy); if(!r2.ok) throw 0;
    const txt2 = await r2.text();
    const safe = txt2.trim().split(/\n(?=\{)/).length>1 ? '['+txt2.trim().split(/\n(?=\{)/).join(',')+']' : txt2;
    return JSON.parse(safe);
  }catch(e){ throw new Error('Fetch failed: '+url); }
}

// Fetch TEXT (HTML) via read-only mirror (handles CORS)
async function getText(url){
  try{
    const proxy = 'https://r.jina.ai/http://' + url.replace(/^https?:\/\//,'');
    const r = await fetch(proxy); if(!r.ok) return ''; return await r.text();
  }catch(e){ return ''; }
}

// DoH DNS
async function doh(name, type='A'){
  const cf = 'https://cloudflare-dns.com/dns-query?name='+encodeURIComponent(name)+'&type='+encodeURIComponent(type);
  try{
    const r=await fetch(cf,{headers:{'accept':'application/dns-json'}});
    if(!r.ok) throw 0; const j=await r.json(); return (j.Answer||[]).map(a=>a.data);
  }catch(_){
    try{
      const gg='https://dns.google/resolve?name='+encodeURIComponent(name)+'&type='+encodeURIComponent(type);
      const r2=await fetch(gg,{headers:{'accept':'application/dns-json'}});
      if(!r2.ok) return []; const j2=await r2.json(); return (j2.Answer||[]).map(a=>a.data);
    }catch(e){ return []; }
  }
}
const dmarcFrom=(arr)=> (arr||[]).find(t=>t.includes('v=DMARC1'))||null;
const spfFrom=(arr)=> (arr||[]).find(t=>t.includes('v=spf1'))||null;

// RDAP / Geo / CT / Subdomains
async function rdap(domain){ try{ return await getJSON('https://rdap.org/domain/'+encodeURIComponent(domain)); }catch(e){ return {}; }}
async function geo(ip){ try{ const r=await fetch('https://ipwho.is/'+encodeURIComponent(ip)); if(!r.ok) return {}; return r.json(); }catch(e){ return {}; } }
async function crt(needle){
  const url='https://crt.sh/?q=%25'+encodeURIComponent(needle)+'%25&output=json';
  try{
    const data = await getJSON(url);
    const set=new Set(), out=[]; const arr = Array.isArray(data)? data : (data? [data] : []);
    for(const rec of arr){
      const names=(rec.name_value||'').split('\n').map(s=>s.replace(/^\*\.?/,'').trim().toLowerCase()).filter(Boolean);
      for(const n of names){ if(!set.has(n)){ set.add(n); out.push(n);} }
    }
    return out;
  }catch(e){ return []; }
}
async function subdomains(domain){
  const url='https://sonar.omnisint.io/subdomains/'+encodeURIComponent(domain);
  try{ const r=await fetch(url); if(r.ok) return r.json(); throw 0; }
  catch(_){ try{ return await getJSON(url); } catch(e){ return []; } }
}

// Render helpers
function renderTable(sel, headers, rows){
  const table=$(sel); const thead=table.querySelector('thead'); const tbody=table.querySelector('tbody');
  if(thead) thead.innerHTML = '<tr>'+headers.map(h=>'<th>'+esc(h)+'</th>').join('')+'</tr>';
  if(tbody) tbody.innerHTML = rows.length? rows.map(r=>'<tr>'+r.map(c=>'<td>'+esc(c??'')+'</td>').join('')+'</tr>').join('') : '<tr><td colspan="'+headers.length+'" class="muted">No data</td></tr>';
}
function kv(tbodySel, rows){ const el=$(tbodySel); el.innerHTML = rows.map(([k,v])=>'<tr><td><b>'+esc(k)+'</b></td><td>'+esc(v??'')+'</td></tr>').join(''); }
function badge(type, text){ return '<span class="badge '+type+'">'+esc(text)+'</span>'; }
function sim(a,b){ a=(a||'').toLowerCase(); b=(b||'').toLowerCase(); const sa=new Set(a), sb=new Set(b); return sa.size&&sb.size? [...sa].filter(x=>sb.has(x)).length / new Set([...sa,...sb]).size : 0; }
function risk(score){ if(score>=0.75) return badge('bad','HIGH '+score.toFixed(2)); if(score>=0.45) return badge('warn','MEDIUM '+score.toFixed(2)); return badge('good','LOW '+score.toFixed(2)); }
const TLDS = ["com","net","org","io","co","ai","app","dev","site","online","info","biz","xyz","cloud","shop","in","ru","de","fr","it","es","nl","pl","se","no","fi","dk","eu","uk","co.uk","com.au","ca","jp","kr","vn","sg","hk","tw","br","mx","ar","za","tr","ua","cz","sk","ro","hu","pt","ie","ch","at","be","gr","lt","lv","ee","il","sa","ae","qa","kw","nz"];

// ===== Scan logic =====
let RESULTS = {};
let RUNNING = false;
function setProgress(txt){ $('#progress').innerHTML = txt? '<span class="spinner"></span> '+esc(txt) : ''; }
function setBusy(b){ RUNNING=b; $('#scanBtn').disabled=b; $('#demo').disabled=b; }

async function sweepBrand(brand){
  const targets = TLDS.map(tld=> brand+'.'+tld);
  const rows=[]; let done=0; const batch=6;
  async function worker(list){
    for(const d of list){
      setProgress('Brand sweep '+(++done)+'/'+targets.length+': '+d);
      let A=[], MX=[]; try{ A=await doh(d,'A'); }catch(e){} try{ MX=await doh(d,'MX'); }catch(e){}
      let created='', registrar='';
      try{ const r = await rdap(d); const ev=(r.events||[]); created=(ev.find(e=>e.eventAction==='registration')||{}).eventDate||''; registrar=(r.registrar && (r.registrar.name||r.registrar.email))||''; }catch(e){}
      let country='', asn='', isp='';
      if(A && A[0]){ try{ const g=await geo(A[0]); country=g.country||''; asn=g.connection?('AS'+g.connection.asn):(g.asn||''); isp=g.connection?.isp||g.isp||''; }catch(e){} }
      rows.push([d, created?created.slice(0,10):'', registrar, A&&A.length?'Yes':'No', MX&&MX.length?'Yes':'No', (A&&A[0])||'', country, asn, isp]);
    }
  }
  const chunks = Array.from({length:batch}, ()=>[]);
  targets.forEach((t,i)=>chunks[i%batch].push(t));
  await Promise.all(chunks.map(worker));
  rows.sort((a,b)=> (b[4]==='Yes') - (a[4]==='Yes') || (b[1]||'').localeCompare(a[1]||''));
  renderTable('#tld', ["Domain","Created","Registrar","A?","MX?","First A","Country","ASN","ISP"], rows);
  return rows;
}

async function scanDomain(domain){
  let A=[],AAAA=[],MX=[],NS=[],TXT=[],DMARCtxt=[];
  try{ A = await doh(domain,'A'); }catch(e){}
  try{ AAAA = await doh(domain,'AAAA'); }catch(e){}
  try{ MX = await doh(domain,'MX'); }catch(e){}
  try{ NS = await doh(domain,'NS'); }catch(e){}
  try{ TXT = await doh(domain,'TXT'); }catch(e){}
  try{ DMARCtxt = await doh('_dmarc.'+domain,'TXT'); }catch(e){}
  const SPF = spfFrom(TXT), DMARC = dmarcFrom(DMARCtxt);
  renderTable('#dns', ['Type','Values'], [
    ['A / AAAA', [...(A||[]),...(AAAA||[])].join('\n')],
    ['MX', (MX||[]).join('\n')],
    ['NS', (NS||[]).join('\n')],
    ['TXT', (TXT||[]).join('\n')],
  ]);
  renderTable('#mail', ['Control','Value'], [
    ['SPF', SPF||'Missing'],
    ['DMARC', DMARC? 'Present':'Missing'],
    ['DMARC TXT', DMARC||'—'],
  ]);
  const r = await rdap(domain); const ev=r.events||[];
  let created = (ev.find(e=>e.eventAction==='registration')||{}).eventDate || '';
  let changed = (ev.find(e=>e.eventAction==='last changed')||{}).eventDate || '';
  const registrar = (r.registrar && (r.registrar.name || r.registrar.email)) || '';
  const status = (r.status||[]).join(', ');
  let privacy=false;
  for(const ent of (r.entities||[])){
    const va = ent.vcardArray && ent.vcardArray[1] || [];
    for(const it of va){ if(Array.isArray(it) && it[0]==='org'){ const org=(it[3]||'').toString().toLowerCase(); if(/privacy|proxy|guard/.test(org)) privacy=true; } }
  }
  kv('#rdap', [['Registrar', registrar], ['Registered', created], ['Last changed', changed], ['Status', status], ['Privacy/Proxy', privacy?'Yes':'No']]);
  const rows=[['IP','Country','ASN','ISP']];
  for(const ip of (A||[]).slice(0,5)){
    try{ const g=await geo(ip); rows.push([ip, g.country||'', g.connection?('AS'+g.connection.asn):(g.asn||''), g.connection?.isp||g.isp||'']); }
    catch(e){ rows.push([ip,'','','']); }
  }
  renderTable('#geo', rows.shift(), rows);
  const subs = await subdomains(domain);
  renderTable('#subs', ['Subdomain'], (subs||[]).map(s=>[s]));
  return {A,MX,created,DMARC,registrar,TXT};
}

async function scanCT(needle, domain){
  const names = await crt(needle);
  const cleaned = (names||[]).filter(n => !domain || n!==domain);
  const rows = cleaned.map(n=>[n, sim(n, needle).toFixed(3)]).sort((a,b)=> parseFloat(b[1])-parseFloat(a[1])).slice(0,200);
  renderTable('#ct', ['Name','Similarity'], rows);
  return rows;
}

function normalizeDomain(d){ return d.replace(/^https?:\/\//,'').replace(/\/$/,'').toLowerCase(); }
function normalizeBrand(b){ return b.replace(/[^a-z0-9-]/gi,'').toLowerCase(); }

// ===== Add-ons =====

// Public email discovery
function extractEmails(text){ const re=/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/gi; return [...new Set((text.match(re)||[]))]; }
async function gatherPublicEmails(domain, txtRecords){
  setProgress('Gathering public emails…');
  const base='https://'+domain;
  const pages=['/','.well-known/security.txt','/security.txt','/contact','/about','/support','/legal','/privacy','/impressum'];
  const found=new Set();

  for(const t of (txtRecords||[])){ // DMARC rua/ruf
    const m = t.match(/ru[af]=mailto:([^,\s]+)/gi);
    if(m){ m.forEach(s=>found.add(s.split(':').pop())); }
  }
  try{ // SOA rname
    const soa = await doh(domain,'SOA');
    if(soa && soa[0]){
      const parts=soa[0].split(' ');
      if(parts[1]){ const rname=parts[1].replace(/\.$/,'').replace(/\./g,'@'); if(/@/.test(rname)) found.add(rname); }
    }
  }catch(e){}

  for(const p of pages){
    const html = await getText(base.replace(/\/$/,'')+p);
    if(!html) continue;
    extractEmails(html).forEach(e=>found.add(e));
    const mailtos = [...html.matchAll(/mailto:([^"'>\s]+)/gi)].map(m=>m[1].split('?')[0]);
    mailtos.forEach(e=>found.add(e));
  }
  const list=[...found].sort();
  renderTable('#emails',['Email'], list.map(e=>[e]));
  return list;
}

// Branding: icons & og:image + Clearbit fallback
async function fetchBranding(domain){
  setProgress('Discovering branding…');
  const base='https://'+domain;
  const html = await getText(base);
  const out = [];
  const logosEl = $('#logos'); if(logosEl) logosEl.innerHTML='';

  if(html){
    const iconHrefs = [...html.matchAll(/<link[^>]+rel=["'](?:icon|shortcut icon|apple-touch-icon)["'][^>]*>/gi)]
      .map(m=>m[0]).map(tag=> (tag.match(/href=["']([^"']+)/i)||[])[1]).filter(Boolean)
      .map(h=>{ try{ return new URL(h, base).href; }catch(e){ return h; } });
    const og = (html.match(/property=["']og:image["'][^>]*content=["']([^"']+)/i)||[])[1];
    if(og){ try{ iconHrefs.push(new URL(og, base).href); }catch(e){ iconHrefs.push(og); } }
    const imgs=[...new Set(iconHrefs)];
    imgs.forEach(src=>{ const img=new Image(); img.src=src; img.alt='logo'; $('#logos')?.appendChild(img); out.push(['Icon',src]); });
  }
  const cb='https://logo.clearbit.com/'+domain; // fallback
  out.push(['Clearbit', cb]);
  const cbImg=new Image(); cbImg.src=cb; cbImg.alt='clearbit-logo'; $('#logos')?.appendChild(cbImg);

  const tbody = $('#branding')?.querySelector('tbody'); const thead=$('#branding')?.querySelector('thead');
  if(thead) thead.innerHTML='<tr><th>Source</th><th>URL</th></tr>';
  if(tbody) tbody.innerHTML = out.map(([label,url])=>'<tr><td>'+esc(label)+'</td><td><a href="'+esc(url)+'" target="_blank" rel="noreferrer">'+esc(url)+'</a></td></tr>').join('');
  return out;
}

// Social profiles from homepage
async function findSocials(domain){
  setProgress('Finding social profiles…');
  const base='https://'+domain; const html = await getText(base);
  const rows=[]; if(!html){ renderTable('#social',["Network","URL"],[]); return []; }
  function grab(re){ return [...new Set((html.match(re)||[]))]; }
  const links = [
    ...grab(/https?:\/\/([a-z]+\.)?linkedin\.com\/[A-Za-z0-9_\-\/]+/gi),
    ...grab(/https?:\/\/twitter\.com\/[A-Za-z0-9_]+/gi),
    ...grab(/https?:\/\/x\.com\/[A-Za-z0-9_]+/gi),
    ...grab(/https?:\/\/facebook\.com\/[A-Za-z0-9_.\-\/]+/gi),
    ...grab(/https?:\/\/www\.youtube\.com\/[A-Za-z0-9_.\-\/]+/gi),
    ...grab(/https?:\/\/instagram\.com\/[A-Za-z0-9_.\-\/]+/gi),
  ];
  links.forEach(u=>{
    let n='Other';
    if(/linkedin/i.test(u)) n='LinkedIn';
    else if(/twitter|x\.com/i.test(u)) n='Twitter/X';
    else if(/facebook/i.test(u)) n='Facebook';
    else if(/youtube/i.test(u)) n='YouTube';
    else if(/instagram/i.test(u)) n='Instagram';
    rows.push([n,u]);
  });
  const t=$('#social'); if(t){ t.querySelector('thead').innerHTML='<tr><th>Network</th><th>URL</th></tr>';
    t.querySelector('tbody').innerHTML = rows.length? rows.map(r=>'<tr><td>'+esc(r[0])+'</td><td><a href="'+esc(r[1])+'" target="_blank" rel="noreferrer">'+esc(r[1])+'</a></td></tr>').join('') : '<tr><td colspan="2" class="muted">No social links found</td></tr>'; }
  return rows;
}

// OSINT toolbox (quick links)
function buildToolbox(domain, brand, AIPs){
  setProgress('Building OSINT toolbox…');
  const e = encodeURIComponent; const ip = (AIPs && AIPs[0]) || ''; const box = $('#toolbox'); if(!box) return;
  const cards = [
    { title:'WHOIS Lookup', links:[
      ['ICANN Lookup', `https://lookup.icann.org/en/lookup?name=${e(domain)}`],
      ['WHOIS.com', `https://www.whois.com/whois/${e(domain)}`],
      ['DomainTools WHOIS', `https://whois.domaintools.com/${e(domain)}`],
      ['RDAP (rdap.org)', `https://rdap.org/domain/${e(domain)}`],
    ]},
    { title:'DNS Lookup', links:[
      ['DNSDumpster', `https://dnsdumpster.com/`],
      ['ViewDNS.info — records', `https://viewdns.info/dnsrecord/?domain=${e(domain)}`],
      ['MXToolbox SuperTool', `https://mxtoolbox.com/SuperTool.aspx?domain=${e(domain)}`],
    ]},
    { title:'Historical DNS & Snapshots', links:[
      ['SecurityTrails — history', `https://securitytrails.com/domain/${e(domain)}/history`],
      ['Wayback Machine', `https://web.archive.org/web/*/${e('http://'+domain)}`],
    ]},
    { title:'Subdomain Enumeration', links:[
      ['Subfinder (GitHub)', 'https://github.com/projectdiscovery/subfinder'],
      ['Amass (GitHub)', 'https://github.com/OWASP/Amass'],
      ['Sublist3r (GitHub)', 'https://github.com/aboul3la/Sublist3r'],
      ['AssetFinder (GitHub)', 'https://github.com/tomnomnom/assetfinder'],
      ['Findomain (GitHub)', 'https://github.com/Findomain/Findomain'],
    ]},
    { title:'SSL/TLS Certificate Analysis', links:[
      ['SSL Labs Server Test', `https://www.ssllabs.com/ssltest/analyze.html?d=${e(domain)}`],
      ['Censys certificates', `https://search.censys.io/certificates?q=${e(domain)}`],
      ['crt.sh', `https://crt.sh/?q=%25${e(domain)}%25`],
    ]},
    { title:'Threat Intelligence & Reputation', links:[
      ['VirusTotal (domain)', `https://www.virustotal.com/gui/domain/${e(domain)}`],
      ['URLVoid', `https://www.urlvoid.com/scan/${e(domain)}/`],
      [ip ? `AbuseIPDB (${ip})` : 'AbuseIPDB', ip ? `https://www.abuseipdb.com/check/${e(ip)}` : 'https://www.abuseipdb.com/'],
      ['PhishTank search', `https://www.phishtank.com/search.php?search=${e(domain)}&IsSearch=Y`],
    ]},
    { title:'Web Scraping & Fingerprinting', links:[
      ['Wappalyzer Lookup', `https://www.wappalyzer.com/lookup/${e(domain)}`],
      ['BuiltWith', `https://builtwith.com/${e(domain)}`],
      ['WhatWeb (GitHub)', 'https://github.com/urbanadventurer/WhatWeb'],
      ['Nikto (GitHub)', 'https://github.com/sullo/nikto'],
    ]},
    { title:'Email & Social Media OSINT', links:[
      ['Hunter.io domain search', `https://hunter.io/domain-search/${e(domain)}`],
      ['EmailHippo tools', 'https://tools.emailhippo.com/'],
      ['Sherlock (GitHub)', 'https://github.com/sherlock-project/sherlock'],
      ['SocialScan (GitHub)', 'https://github.com/iojw/socialscan'],
    ]},
    { title:'Geolocation & IP Analysis', links:[
      [ip ? `IPinfo (${ip})` : 'IPinfo', ip ? `https://ipinfo.io/${e(ip)}` : 'https://ipinfo.io/'],
      [ip ? `IP2Location (${ip})` : 'IP2Location', ip ? `https://www.ip2location.com/demo/${e(ip)}` : 'https://www.ip2location.com/'],
      ['MaxMind GeoIP', 'https://dev.maxmind.com/geoip/'],
    ]},
    { title:'Automation & Frameworks', links:[
      ['SpiderFoot (GitHub)', 'https://github.com/smicallef/spiderfoot'],
      ['Maltego Community Edition', 'https://www.maltego.com/'],
      ['theHarvester (GitHub)', 'https://github.com/laramies/theHarvester'],
      ['OSINT Framework', 'https://osintframework.com/'],
    ]},
    { title:'Logo reuse (manual checks)', links:[
      ['Google Images: brand logo', `https://www.google.com/search?tbm=isch&q=${e(brand+' logo')}`],
      ['Bing Images: brand logo', `https://www.bing.com/images/search?q=${e(brand+' logo')}`],
      ['Yandex Images: brand logo', `https://yandex.com/images/search?text=${e(brand+' logo')}`],
    ]},
  ];
  box.innerHTML = cards.map(card=>{
    const lis = card.links.map(([label,url])=>`<li><a href="${esc(url)}" target="_blank" rel="noreferrer">${esc(label)}</a></li>`).join('');
    return `<div class="toolcard"><h3>${esc(card.title)}</h3><ul>${lis}</ul></div>`;
  }).join('');
}

// ===== Runner =====
function normalizeInputs(){
  const domainRaw = $('#domain').value.trim();
  const brandRaw = $('#brand').value.trim();
  return {
    domain: domainRaw? domainRaw.replace(/^https?:\/\//,'').replace(/\/$/,'').toLowerCase() : '',
    brand:  brandRaw?  brandRaw.replace(/[^a-z0-9-]/gi,'').toLowerCase() : ''
  };
}

async function run(){
  if(RUNNING) return;
  const {domain, brand} = normalizeInputs();
  if(!domain && !brand){ alert('Enter a Domain and/or Brand'); return; }

  // reset UI
  $('#summary').innerHTML = '<span class="spinner"></span> Running lookups…';
  ['#tld','#dns','#mail','#geo','#ct','#subs','#emails','#branding','#social'].forEach(sel=>{
    const el=$(sel); if(!el) return; const h=el.querySelector('thead'); const b=el.querySelector('tbody'); if(h) h.innerHTML=''; if(b) b.innerHTML='';
  });
  $('#rdap').innerHTML=''; $('#logos').innerHTML=''; $('#toolbox').innerHTML=''; setProgress(''); setBusy(true);

  const results = {input:{domain,brand}, startedAt:new Date().toISOString()};

  try{
    if(brand){ const rows = await sweepBrand(brand); results.tldSweep = rows; }

    let dres = {};
    if(domain){
      setProgress('Domain lookups for '+domain+'…');
      dres = await scanDomain(domain); results.domain = dres;
    }

    const needle = brand || (domain? domain.split('.')[0] : '');
    if(needle){
      setProgress('CT log search for "'+needle+'”…');
      const ctrows = await scanCT(needle, domain); results.ct = ctrows;
    }

    if(domain){
      try{ await fetchBranding(domain); }catch(e){}
      try{ await gatherPublicEmails(domain, (results.domain&&results.domain.TXT)||[]); }catch(e){}
      try{ await findSocials(domain); }catch(e){}
      try{ buildToolbox(domain, brand, results.domain && results.domain.A); }catch(e){}
    }

    const hasMX = results.domain && results.domain.MX && results.domain.MX.length>0;
    const dmarcMissing = results.domain ? !(results.domain.DMARC) : false;
    const recent = results.domain && results.domain.created ? (new Date(results.domain.created) > new Date(Date.now()-1000*60*60*24*30)) : false;
    let score = 0; if(hasMX) score += .25; if(dmarcMissing) score += .25; if(recent) score += .15;
    const ctHigh = (results.ct||[]).some(r=> parseFloat(r[1])>0.7); if(ctHigh) score += .2;

    $('#summary').innerHTML = risk(score) +
      (domain? ' '+ (hasMX? '<span class="badge warn">MX present</span>' : '<span class="badge good">No MX</span>') : '') +
      (domain? ' '+ (dmarcMissing? '<span class="badge bad">DMARC missing</span>' : '<span class="badge good">DMARC present</span>') : '');

    setProgress(''); results.finishedAt = new Date().toISOString(); LAST = results;
  }catch(err){
    console.error(err); setProgress('');
    $('#summary').innerHTML = '<span class="badge bad">Error</span> '+esc(err.message||'Run failed');
  }finally{
    setBusy(false);
  }
}

// Wire up
$('#f').addEventListener('submit', (e)=>{ e.preventDefault(); run(); });
$('#demo').addEventListener('click', ()=>{ $('#domain').value='congruex.com'; $('#brand').value='congruex'; run(); });
$('#dljson').addEventListener('click', ()=> downloadJSON(LAST));
$('#dlcsv').addEventListener('click', ()=> {
  const rows = (LAST.tldSweep||[]);
  if(!rows.length){ alert('No brand sweep data yet. Enter a brand and run a scan.'); return; }
  downloadCSV(rows, ["Domain","Created","Registrar","A?","MX?","First A","Country","ASN","ISP"]);
});
</script>
</body>
</html>
