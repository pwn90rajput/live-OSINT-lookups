<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>OSINT Monitor — Extended Version</title>
  <style>
    body{background:#0b1020;color:#e7ecff;font:15px/1.55 system-ui}
    .card{background:#0f1a34;border-radius:14px;padding:14px;margin:12px 0}
    h2{margin:12px 0 10px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:9px;border-bottom:1px solid #22325a;vertical-align:top}
    th{background:#0f1a34;position:sticky;top:0}
    tr:hover{background:#101f45}
    .muted{color:#a9b4d6;font-size:13px}
    .spinner{width:16px;height:16px;border:2px solid #2a3a6a;border-top-color:#7aa2ff;border-radius:50%;animation:spin .8s linear infinite;display:inline-block}
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>
<body>
  <div class="card">
    <h2>Domain Scan</h2>
    <form id="f" autocomplete="off">
      <input id="domain" type="text" placeholder="example.com" />
      <button type="submit" id="scanBtn">Scan</button>
    </form>
    <div id="progress" class="muted"></div>
  </div>

  <section class="card">
    <h2>SSL Labs (Grade)</h2>
    <div id="sslStatus" class="muted"></div>
    <table id="sslTable"><thead></thead><tbody></tbody></table>
  </section>

  <section class="card">
    <h2>Public Emails (discovered)</h2>
    <table id="emails"><thead></thead><tbody></tbody></table>
  </section>

  <section class="card">
    <h2>Open Ports (Nmap-like)</h2>
    <table id="openports"><thead></thead><tbody></tbody></table>
  </section>

<script>
const $=(s)=>document.querySelector(s);
const sleep=(ms)=>new Promise(r=>setTimeout(r,ms));
function renderTable(sel, headers, rows){
  const table=$(sel), thead=table.querySelector('thead'), tbody=table.querySelector('tbody');
  thead.innerHTML='<tr>'+headers.map(h=>'<th>'+h+'</th>').join('')+'</tr>';
  tbody.innerHTML= rows.length? rows.map(r=>'<tr>'+r.map(c=>'<td>'+c+'</td>').join('')+'</tr>').join('')
                                : '<tr><td colspan="'+headers.length+'" class="muted">No data</td></tr>';
}
function setProgress(txt){ $('#progress').innerHTML = txt? '<span class="spinner"></span> '+txt : ''; }
async function getJSON(url){
  const r=await fetch(url,{headers:{'accept':'application/json'}});
  if(r.ok) return r.json(); throw new Error('fetch failed');
}

// ===== SSL Labs =====
async function sslLabs(domain){
  $('#sslStatus').innerHTML='Starting SSL Labs scan…'; 
  renderTable('#sslTable',['IP','Grade','Status'],[]);
  let tries=0, started=false;
  while(tries<25){
    tries++;
    try{
      const url='https://api.ssllabs.com/api/v3/analyze?host='+encodeURIComponent(domain)+'&all=done'+(started?'&startNew=off':'&startNew=on');
      const j=await getJSON(url);
      const st=j.status||'UNKNOWN'; $('#sslStatus').innerHTML='SSL Labs: '+st+' ('+tries+')';
      if(st==='READY' && Array.isArray(j.endpoints)){
        const rows=j.endpoints.map(ep=>[ep.ipAddress||'', ep.grade||'', ep.statusMessage||'']);
        renderTable('#sslTable',['IP','Grade','Status'],rows); 
        $('#sslStatus').innerHTML='SSL Labs: READY'; 
        return rows;
      }
      if(st==='ERROR' || st==='DNS'){ $('#sslStatus').innerHTML='SSL Labs: '+st; return []; }
    }catch(e){}
    started=true; await sleep(6000);
  }
  $('#sslStatus').innerHTML='SSL Labs: Timed out / no result';
  return [];
}

// ===== Public Emails (simple improved relevance) =====
function extractEmails(text){ const re=/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/gi; return [...new Set((text.match(re)||[]))]; }
async function gatherPublicEmails(domain){
  setProgress('Gathering public emails…');
  const base='https://'+domain;
  const pages=['/','.well-known/security.txt','/contact','/about','/team','/support'];
  const found=new Set();
  for(const p of pages){ 
    try{ const r=await fetch(base+p); if(r.ok){ const t=await r.text(); extractEmails(t).forEach(e=>found.add(e)); } }catch{}
  }
  const list=[...found].filter(e=>e.endsWith(domain)).sort();
  renderTable('#emails',['Email'], list.map(e=>[e]));
  return list;
}

// ===== Nmap-like Open Ports (Shodan InternetDB) =====
const COMMON_PORTS={80:'http',443:'https',22:'ssh',25:'smtp',53:'dns',3306:'mysql',3389:'rdp'};
async function openPorts(domain){
  setProgress('Fetching open ports…');
  try{
    const ipRes=await fetch('https://dns.google/resolve?name='+domain+'&type=A');
    const ipJson=await ipRes.json(); const ip=ipJson.Answer? ipJson.Answer[0].data : null;
    if(!ip){ renderTable('#openports',['Port','Service'],[]); return []; }
    const data=await getJSON('https://internetdb.shodan.io/'+ip);
    const ports=(data.ports||[]).map(p=>[p, COMMON_PORTS[p]||'unknown']);
    renderTable('#openports',['Port','Service'],ports);
    return ports;
  }catch(e){ renderTable('#openports',['Port','Service'],[]); return []; }
}

// ===== Orchestrator =====
async function runScan(domain){
  setProgress('Scanning '+domain+'…');
  await sslLabs(domain);
  await gatherPublicEmails(domain);
  await openPorts(domain);
  setProgress('Done.');
}
$('#f').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const d=($('#domain').value||'').trim().toLowerCase();
  if(!d) return;
  await runScan(d);
});
</script>
</body>
</html>