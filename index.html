<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OSINT Lookup Dashboard</title>
<style>
  :root {
    --bg:#0f111a; --panel:#1a1d2b; --accent:#00bfa5;
    --text:#f5f5f5; --muted:#9fa6b2; --border:#2a2e3f; --danger:#ff5252;
  }
  body{background:var(--bg);color:var(--text);font-family:"Segoe UI",sans-serif;margin:0}
  header{background:linear-gradient(90deg,#00bfa5,#1de9b6);color:#000;text-align:center;padding:16px;font-weight:600;font-size:1.3em}
  .input-bar{text-align:center;margin:20px}
  input{width:300px;padding:8px 12px;border:1px solid var(--accent);border-radius:5px;background:#151827;color:var(--text)}
  button{background:var(--accent);border:none;border-radius:5px;padding:8px 14px;margin-left:10px;cursor:pointer;font-weight:600}
  button:hover{filter:brightness(1.1)}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(340px,1fr));gap:20px;padding:20px}
  .panel{background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:16px;box-shadow:0 4px 8px rgba(0,0,0,0.3)}
  .panel h2{border-bottom:2px solid var(--accent);padding-bottom:8px;margin-top:0}
  pre{background:#11141f;color:var(--muted);padding:12px;border-radius:6px;overflow:auto;font-size:.9em}
  footer{text-align:center;color:var(--muted);padding:15px;border-top:1px solid var(--border)}
  .score.low{color:#00e676}.score.med{color:#ffd166}.score.high{color:var(--danger)}
</style>
</head>
<body>
<header>OSINT Lookup Dashboard</header>
<div class="input-bar">
  <input id="domainInput" type="text" placeholder="Enter domain or URL (e.g., https://example.com)">
  <button onclick="runLookup()">Run</button>
</div>
<div class="grid">
  <div class="panel"><h2>Reputation & Hosting</h2><pre id="reputation">Waiting for input...</pre></div>
  <div class="panel"><h2>WHOIS / RDAP</h2><pre id="whois">Waiting for input...</pre></div>
  <div class="panel"><h2>DNS Records</h2><pre id="dns">Waiting for input...</pre></div>
  <div class="panel"><h2>Subdomains</h2><pre id="subs">Waiting for input...</pre></div>
  <div class="panel"><h2>Mail TXT / SPF / DMARC</h2><pre id="mail">Waiting for input...</pre></div>
  <div class="panel"><h2>Wayback Snapshots</h2><pre id="wayback">Waiting for input...</pre></div>
</div>
<footer>© 2025 OSINT Lookup Pro | Fixed CORS + Reputation Edition</footer>
<script>
async function fetchJSON(url){
  try{
    const res=await fetch(url);
    if(!res.ok)throw new Error(res.status);
    return await res.json();
  }catch(e){
    // try proxy if blocked
    const proxy=`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
    const res2=await fetch(proxy);
    if(!res2.ok)throw new Error(res2.status);
    return await res2.json();
  }
}
function domainOnly(str){try{return new URL(str).hostname}catch{return str}}
function riskLabel(score){return score>=70?`<span class='score high'>${score} (High)</span>`:score>=40?`<span class='score med'>${score} (Medium)</span>`:`<span class='score low'>${score} (Low)</span>`}

async function runLookup(){
  const input=document.getElementById('domainInput').value.trim();
  if(!input)return alert('Enter domain or URL');
  const domain=domainOnly(input);
  document.getElementById('whois').textContent='Loading...';
  document.getElementById('dns').textContent='Loading...';
  document.getElementById('subs').textContent='Loading...';
  document.getElementById('mail').textContent='Loading...';
  document.getElementById('wayback').textContent='Loading...';
  document.getElementById('reputation').textContent='Loading...';

  // WHOIS / RDAP
  let whois=''; 
  try{
    const rdap=await fetchJSON(`https://rdap.org/domain/${domain}`);
    whois=`Domain: ${rdap.ldhName||domain}\nRegistrar: ${(rdap.entities||[])[0]?.vcardArray?.[1]?.find(v=>v[0]==='fn')?.[3]||'—'}\nCreated: ${(rdap.events||[]).find(e=>e.eventAction==='registration')?.eventDate||'—'}\nExpires: ${(rdap.events||[]).find(e=>e.eventAction==='expiration')?.eventDate||'—'}`;
  }catch{whois='RDAP lookup failed';}
  document.getElementById('whois').textContent=whois;

  // DNS
  let ips=[];
  try{
    const dns=await fetchJSON(`https://dns.google/resolve?name=${domain}`);
    ips=(dns.Answer||[]).filter(a=>a.type===1).map(a=>a.data);
    document.getElementById('dns').textContent=ips.length?`A: ${ips.join(', ')}`:'No A records';
  }catch{document.getElementById('dns').textContent='DNS lookup failed';}

  // SPF / DMARC
  try{
    const txt=await fetchJSON(`https://dns.google/resolve?name=${domain}&type=TXT`);
    const spf=(txt.Answer||[]).map(a=>a.data).find(t=>t.includes('spf'))||'—';
    const dmarc=await fetchJSON(`https://dns.google/resolve?name=_dmarc.${domain}&type=TXT`);
    const dmarcVal=(dmarc.Answer||[]).map(a=>a.data).find(t=>t.includes('DMARC'))||'—';
    document.getElementById('mail').textContent=`SPF: ${spf}\nDMARC: ${dmarcVal}`;
  }catch{document.getElementById('mail').textContent='Mail TXT lookup failed';}

  // Subdomains via urlscan (with proxy fallback)
  try{
    const subdata=await fetchJSON(`https://urlscan.io/api/v1/search/?q=domain:${domain}`);
    const subs=[...new Set((subdata.results||[]).map(r=>r.page?.domain).filter(Boolean))];
    document.getElementById('subs').textContent=subs.slice(0,30).join('\n')||'No subdomains found';
  }catch(e){document.getElementById('subs').textContent='urlscan fetch failed';}

  // Wayback snapshots (CDX API)
  try{
    const wb=await fetchJSON(`https://web.archive.org/cdx/search/cdx?url=${domain}/*&output=json&fl=timestamp,original&limit=5&collapse=timestamp:8`);
    if(Array.isArray(wb)&&wb.length>1){
      const list=wb.slice(1).map(x=>`${x[0].slice(0,4)}-${x[0].slice(4,6)}-${x[0].slice(6,8)}  ${x[1]}`);
      document.getElementById('wayback').textContent=list.join('\n');
    }else document.getElementById('wayback').textContent='No snapshots found';
  }catch(e){document.getElementById('wayback').textContent='Wayback fetch failed';}

  // Reputation / Hosting
  try{
    let ipInfo='';let risk=0;
    if(ips.length){
      const ip=ips[0];
      const ipdata=await fetchJSON(`https://ipapi.co/${ip}/json/`);
      ipInfo=`IP: ${ip}\nASN: ${ipdata.asn||'—'}\nOrg: ${ipdata.org||'—'}\nCountry: ${ipdata.country_name||'—'}\nRegion: ${ipdata.region||'—'}\nCity: ${ipdata.city||'—'}`;
      if(/cloudflare|ovh|digitalocean|aws|azure/i.test(ipdata.org||''))risk+=20;
    }
    // quick risk estimate
    if(domain.split('.').length>3)risk+=20;
    if(/[\d-]{5,}/.test(domain))risk+=20;
    if(domain.length>25)risk+=10;
    document.getElementById('reputation').innerHTML=`Domain: ${domain}\n${ipInfo}\nRisk Score: ${riskLabel(risk)}`;
  }catch(e){document.getElementById('reputation').textContent='Reputation check failed';}
}
</script>
</body>
</html>
